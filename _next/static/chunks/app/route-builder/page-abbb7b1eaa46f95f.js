(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{255:(e,t,a)=>{"use strict";function n(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return n}}),a(5155),a(7650),a(5744),a(589)},285:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>l});var n=a(5155),s=a(9708),r=a(2085);a(2115);var i=a(9434);let l=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:r,asChild:o=!1,...c}=e,d=o?s.DX:"button";return(0,n.jsx)(d,{"data-slot":"button",className:(0,i.cn)(l({variant:a,size:r,className:t})),...c})}},1198:(e,t,a)=>{Promise.resolve().then(a.bind(a,8497))},2085:(e,t,a)=>{"use strict";a.d(t,{F:()=>i});var n=a(2596);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=n.$,i=(e,t)=>a=>{var n;if((null==t?void 0:t.variants)==null)return r(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==a?void 0:a[e],n=null==l?void 0:l[e];if(null===t)return null;let r=s(t)||s(n);return i[e][r]}),c=a&&Object.entries(a).reduce((e,t)=>{let[a,n]=t;return void 0===n||(e[a]=n),e},{});return r(e,o,null==t||null==(n=t.compoundVariants)?void 0:n.reduce((e,t)=>{let{class:a,className:n,...s}=t;return Object.entries(s).every(e=>{let[t,a]=e;return Array.isArray(a)?a.includes({...l,...c}[t]):({...l,...c})[t]===a})?[...e,a,n]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)}},2146:(e,t,a)=>{"use strict";function n(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),a(5262)},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{bindSnapshot:function(){return i},createAsyncLocalStorage:function(){return r},createSnapshot:function(){return l}});let a=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}static bind(e){return e}}let s="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function r(){return s?new s:new n}function i(e){return s?s.bind(e):n.bind(e)}function l(){return s?s.snapshot():function(e,...t){return e(...t)}}},5744:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return n.workAsyncStorageInstance}});let n=a(7828)},6101:(e,t,a)=>{"use strict";a.d(t,{s:()=>i,t:()=>r});var n=a(2115);function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function r(...e){return t=>{let a=!1,n=e.map(e=>{let n=s(e,t);return a||"function"!=typeof n||(a=!0),n});if(a)return()=>{for(let t=0;t<n.length;t++){let a=n[t];"function"==typeof a?a():s(e[t],null)}}}}function i(...e){return n.useCallback(r(...e),e)}},6645:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});let n=a(8229)._(a(7357));function s(e,t){var a;let s={};"function"==typeof e&&(s.loader=e);let r={...s,...t};return(0,n.default)({...r,modules:null==(a=r.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7357:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let n=a(5155),s=a(2115),r=a(2146);function i(e){return{default:e&&"default"in e?e.default:e}}a(255);let l={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},o=function(e){let t={...l,...e},a=(0,s.lazy)(()=>t.loader().then(i)),o=t.loading;function c(e){let i=o?(0,n.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,c=l?s.Suspense:s.Fragment,d=t.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(c,{...l?{fallback:i}:{},children:d})}return c.displayName="LoadableComponent",c}},7828:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return n}});let n=(0,a(4054).createAsyncLocalStorage)()},8497:(e,t,a)=>{"use strict";a.d(t,{default:()=>_});var n=a(5155),s=a(2115),r=a(9434),i=a(285);function l(e){let t=[];return e.startLocation&&0!==e.startLocation.trim().length||t.push({field:"startLocation",message:"Start location is required",code:"REQUIRED"}),e.endLocation&&0!==e.endLocation.trim().length||t.push({field:"endLocation",message:"End location is required",code:"REQUIRED"}),e.distance.min<0&&t.push({field:"distance.min",message:"Minimum distance must be positive",code:"INVALID_RANGE"}),e.distance.max<=e.distance.min&&t.push({field:"distance.max",message:"Maximum distance must be greater than minimum distance",code:"INVALID_RANGE"}),e.distance.max>500&&t.push({field:"distance.max",message:"Maximum distance cannot exceed 500km",code:"INVALID_RANGE"}),["road","gravel"].includes(e.rideType)||t.push({field:"rideType",message:'Ride type must be either "road" or "gravel"',code:"INVALID_VALUE"}),["flat","moderate","challenging"].includes(e.elevation)||t.push({field:"elevation",message:'Elevation preference must be "flat", "moderate", or "challenging"',code:"INVALID_VALUE"}),e.pointsOfInterest.forEach((e,a)=>{["bakery","restaurant","cafe","bike_shop","viewpoint"].includes(e.type)||t.push({field:"pointsOfInterest[".concat(a,"].type"),message:"Invalid POI type",code:"INVALID_VALUE"}),(e.distanceKm<=0||e.distanceKm>500)&&t.push({field:"pointsOfInterest[".concat(a,"].distanceKm"),message:"POI distance must be between 1 and 500 km",code:"INVALID_RANGE"})}),{isValid:0===t.length,errors:t}}let o=e=>{let{onRouteGenerate:t,isLoading:a,initialParams:o}=e,[c,d]=(0,s.useState)({startLocation:(null==o?void 0:o.startLocation)||"",endLocation:(null==o?void 0:o.endLocation)||"",rideType:(null==o?void 0:o.rideType)||"road",distance:(null==o?void 0:o.distance)||{min:20,max:50},elevation:(null==o?void 0:o.elevation)||"moderate",pointsOfInterest:(null==o?void 0:o.pointsOfInterest)||[]}),[u,m]=(0,s.useState)({}),[h,p]=(0,s.useState)({}),g=(e,t)=>{d(a=>({...a,[e]:t})),u[e]&&m(t=>({...t,[e]:""}))},x=e=>{"Enter"===e.key&&(e.preventDefault(),v(e))},f=e=>{p(t=>({...t,[e]:!0})),y(e)},y=e=>{let t=l(c).errors.find(t=>t.field===e);t?m(a=>({...a,[e]:t.message})):m(t=>({...t,[e]:""}))},v=e=>{e.preventDefault();let a=l(c);if(!a.isValid){let e={};a.errors.forEach(t=>{e[t.field]=t.message}),m(e);let t={};a.errors.forEach(e=>{t[e.field]=!0}),p(t);return}t(c)},b=e=>{d(t=>({...t,pointsOfInterest:t.pointsOfInterest.filter((t,a)=>a!==e)}))},j=(e,t,a)=>{d(n=>({...n,pointsOfInterest:n.pointsOfInterest.map((n,s)=>s===e?{...n,[t]:a}:n)}))};return(0,n.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,n.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Your Route"}),(0,n.jsx)("p",{className:"text-gray-600 mt-2",children:"Generate an optimized cycling route based on your preferences"})]}),(0,n.jsxs)("form",{onSubmit:v,className:"px-6 py-6 space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"startLocation",className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Location"}),(0,n.jsx)("input",{id:"startLocation",type:"text",value:c.startLocation,onChange:e=>g("startLocation",e.target.value),onBlur:()=>f("startLocation"),onKeyDown:x,placeholder:"Enter starting point (e.g., Zurich, Switzerland)...",className:(0,r.cn)("w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent transition-all",u.startLocation&&h.startLocation?"border-red-500":"border-gray-300 hover:border-gray-400"),disabled:a}),u.startLocation&&h.startLocation&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:u.startLocation})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"endLocation",className:"block text-sm font-medium text-gray-700 mb-2",children:"End Location"}),(0,n.jsx)("input",{id:"endLocation",type:"text",value:c.endLocation,onChange:e=>g("endLocation",e.target.value),onBlur:()=>f("endLocation"),onKeyDown:x,placeholder:"Enter destination (e.g., Geneva, Switzerland)...",className:(0,r.cn)("w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent transition-all",u.endLocation&&h.endLocation?"border-red-500":"border-gray-300 hover:border-gray-400"),disabled:a}),u.endLocation&&h.endLocation&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:u.endLocation})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Ride Type"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{type:"button",onClick:()=>g("rideType","road"),className:(0,r.cn)("flex-1 px-4 py-3 rounded-lg border-2 transition-all text-sm font-medium","road"===c.rideType?"border-black bg-black text-white":"border-gray-300 bg-white text-gray-700 hover:border-gray-400"),disabled:a,children:"\uD83D\uDEB4 Road Cycling"}),(0,n.jsx)("button",{type:"button",onClick:()=>g("rideType","gravel"),className:(0,r.cn)("flex-1 px-4 py-3 rounded-lg border-2 transition-all text-sm font-medium","gravel"===c.rideType?"border-black bg-black text-white":"border-gray-300 bg-white text-gray-700 hover:border-gray-400"),disabled:a,children:"\uD83D\uDEB5 Gravel Cycling"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Distance Range (km)"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"minDistance",className:"block text-xs text-gray-500 mb-1",children:"Minimum"}),(0,n.jsx)("input",{id:"minDistance",type:"number",min:"1",max:"500",value:c.distance.min,onChange:e=>g("distance",{...c.distance,min:parseInt(e.target.value)||0}),onKeyDown:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black hover:border-gray-400 transition-all",disabled:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"maxDistance",className:"block text-xs text-gray-500 mb-1",children:"Maximum"}),(0,n.jsx)("input",{id:"maxDistance",type:"number",min:"1",max:"500",value:c.distance.max,onChange:e=>g("distance",{...c.distance,max:parseInt(e.target.value)||0}),onKeyDown:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black hover:border-gray-400 transition-all",disabled:a})]})]}),(u["distance.min"]||u["distance.max"])&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:u["distance.min"]||u["distance.max"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Elevation Profile"}),(0,n.jsxs)("select",{value:c.elevation,onChange:e=>g("elevation",e.target.value),onKeyDown:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black hover:border-gray-400 transition-all cursor-pointer",disabled:a,children:[(0,n.jsx)("option",{value:"flat",children:"Flat - Minimal elevation changes"}),(0,n.jsx)("option",{value:"moderate",children:"Moderate - Some hills and climbs"}),(0,n.jsx)("option",{value:"challenging",children:"Challenging - Significant elevation gain"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:["Route Waypoints",(0,n.jsx)("span",{className:"text-xs text-gray-500 block font-normal mt-1",children:"Add specific stops at exact distances along your route"})]}),(0,n.jsx)("button",{type:"button",onClick:()=>{let e={type:"cafe",distanceKm:20,name:""};d(t=>({...t,pointsOfInterest:[...t.pointsOfInterest,e]}))},disabled:a,className:"px-4 py-2 bg-black text-white text-sm rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50",children:"+ Add Stop"})]}),0===c.pointsOfInterest.length?(0,n.jsx)("p",{className:"text-gray-500 text-sm italic",children:'No waypoints added. Click "Add Stop" to include specific stops along your route.'}):(0,n.jsx)("div",{className:"space-y-3",children:c.pointsOfInterest.map((e,t)=>(0,n.jsxs)("div",{className:"flex gap-3 items-end p-3 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Type"}),(0,n.jsxs)("select",{value:e.type,onChange:e=>j(t,"type",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",disabled:a,children:[(0,n.jsx)("option",{value:"cafe",children:"Cafe"}),(0,n.jsx)("option",{value:"restaurant",children:"Restaurant"}),(0,n.jsx)("option",{value:"bakery",children:"Bakery"}),(0,n.jsx)("option",{value:"bike_shop",children:"Bike Shop"}),(0,n.jsx)("option",{value:"viewpoint",children:"Viewpoint"})]})]}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"At distance (km)"}),(0,n.jsx)("input",{type:"number",min:"1",max:"500",value:e.distanceKm,onChange:e=>j(t,"distanceKm",parseInt(e.target.value)||20),placeholder:"20",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",disabled:a})]}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Name (optional)"}),(0,n.jsx)("input",{type:"text",value:e.name||"",onChange:e=>j(t,"name",e.target.value),placeholder:"Custom name...",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",disabled:a})]}),(0,n.jsx)(i.$,{type:"button",variant:"outline",size:"sm",onClick:()=>b(t),disabled:a,children:"Remove"})]},t))})]}),(0,n.jsx)("div",{className:"pt-6",children:(0,n.jsx)("button",{type:"submit",disabled:a,className:"w-full px-8 py-4 bg-black text-white text-lg font-medium rounded-lg hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:a?(0,n.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none",opacity:"0.25"}),(0,n.jsx)("path",{fill:"currentColor",opacity:"0.75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating Route..."]}):"Generate Route \uD83D\uDE80"})})]})]})};var c=a(6645),d=a.n(c);let u=d()(()=>Promise.all([a.e(761),a.e(712)]).then(a.bind(a,9712)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[9712]},ssr:!1}),m=d()(()=>Promise.all([a.e(761),a.e(712)]).then(a.bind(a,9712)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[9712]},ssr:!1}),h=d()(()=>Promise.all([a.e(761),a.e(712)]).then(a.bind(a,9712)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[9712]},ssr:!1}),p=d()(()=>Promise.all([a.e(761),a.e(712)]).then(a.bind(a,9712)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[9712]},ssr:!1}),g=d()(()=>Promise.all([a.e(761),a.e(712)]).then(a.bind(a,9712)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[9712]},ssr:!1}),x=e=>{let{route:t,isLoading:i,onRouteModify:l,className:o}=e,c=(0,s.useRef)(null);if((0,s.useEffect)(()=>{a.e(761).then(a.t.bind(a,5752,23)).then(e=>{delete e.Icon.Default.prototype._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"})})},[]),i)return(0,n.jsx)("div",{className:(0,r.cn)("relative h-96 bg-gray-100 rounded-lg overflow-hidden",o),children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Generating your route..."})]})})});if(!t)return(0,n.jsx)("div",{className:(0,r.cn)("relative h-96 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 overflow-hidden",o),children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83D\uDDFA️"}),(0,n.jsx)("p",{className:"text-gray-600 font-medium mb-2",children:"No route generated yet"}),(0,n.jsx)("p",{className:"text-gray-500 text-sm",children:'Fill out the form and click "Generate Route" to see your route preview'})]})})});let d=t.path.length>0?[[Math.min(...t.path.map(e=>e.lat)),Math.min(...t.path.map(e=>e.lng))],[Math.max(...t.path.map(e=>e.lat)),Math.max(...t.path.map(e=>e.lng))]]:void 0,x=t.path.length>0?[t.path.reduce((e,t)=>e+t.lat,0)/t.path.length,t.path.reduce((e,t)=>e+t.lng,0)/t.path.length]:[47.3769,8.5417],f=e=>{switch(e){case"paved":return"#22c55e";case"gravel":return"#f97316";case"trail":return"#8b5cf6";default:return"#6b7280"}},y=e=>({cafe:"☕",restaurant:"\uD83C\uDF7D️",bakery:"\uD83E\uDD56",bike_shop:"\uD83D\uDEB4",viewpoint:"\uD83C\uDFD4️"})[e]||"\uD83D\uDCCD";return(0,n.jsxs)("div",{className:(0,r.cn)("relative rounded-lg overflow-hidden shadow-lg",o),children:[(0,n.jsx)("div",{className:"h-96 w-full",children:(0,n.jsxs)(u,{ref:c,center:x,zoom:d?void 0:10,bounds:d,boundsOptions:{padding:[20,20]},className:"h-full w-full",zoomControl:!0,scrollWheelZoom:!0,children:[(0,n.jsx)(m,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.path.length>1&&(0,n.jsx)(h,{positions:t.path.map(e=>[e.lat,e.lng]),color:f("mixed"),weight:4,opacity:.8}),t.path.length>0&&(0,n.jsx)(p,{position:[t.path[0].lat,t.path[0].lng],children:(0,n.jsx)(g,{children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-lg mb-1",children:"\uD83D\uDE80"}),(0,n.jsx)("strong",{children:"Start"}),(0,n.jsx)("br",{}),(0,n.jsx)("small",{children:"Begin your cycling adventure here"})]})})}),t.path.length>1&&(0,n.jsx)(p,{position:[t.path[t.path.length-1].lat,t.path[t.path.length-1].lng],children:(0,n.jsx)(g,{children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-lg mb-1",children:"\uD83C\uDFC1"}),(0,n.jsx)("strong",{children:"Finish"}),(0,n.jsx)("br",{}),(0,n.jsx)("small",{children:"Your destination"})]})})}),t.pointsOfInterest.map(e=>{var t;return(0,n.jsx)(p,{position:[e.location.lat,e.location.lng],children:(0,n.jsx)(g,{children:(0,n.jsxs)("div",{className:"min-w-[200px]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)("span",{className:"text-lg",children:y(e.type)}),(0,n.jsx)("strong",{className:"text-sm",children:e.name})]}),(0,n.jsxs)("div",{className:"space-y-1 text-xs text-gray-600",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Distance:"})," ",e.distanceFromStart.toFixed(1),"km from start"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Arrival:"})," ",e.estimatedArrivalTime.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("strong",{children:"Status:"}),(0,n.jsx)("span",{className:(0,r.cn)("px-1.5 py-0.5 rounded text-xs font-medium",e.isOpen?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isOpen?"Open":"Closed"})]}),(null==(t=e.contact)?void 0:t.phone)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Phone:"})," ",e.contact.phone]})]})]})})},e.id)})]})}),(0,n.jsxs)("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-md p-3 max-w-xs",children:[(0,n.jsx)("h3",{className:"font-semibold text-sm mb-2",children:t.name}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-500",children:"Distance:"}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{className:"font-medium",children:[t.distance.toFixed(1),"km"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-500",children:"Time:"}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{className:"font-medium",children:[Math.floor(t.estimatedTime/60),"h ",t.estimatedTime%60,"m"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-500",children:"Elevation:"}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{className:"font-medium",children:["+",t.elevationGain,"m"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-500",children:"Difficulty:"}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{className:(0,r.cn)("font-medium capitalize","easy"===t.difficulty&&"text-green-600","moderate"===t.difficulty&&"text-yellow-600","hard"===t.difficulty&&"text-red-600"),children:t.difficulty})]})]})]}),(0,n.jsxs)("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-md p-3",children:[(0,n.jsx)("h4",{className:"font-semibold text-xs mb-2",children:"Surface Types"}),(0,n.jsx)("div",{className:"space-y-1",children:Object.entries(t.surfaceTypes).map(e=>{let[t,a]=e;return a>0&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f(t)}}),(0,n.jsxs)("span",{className:"capitalize",children:[t,": ",a,"%"]})]},t)})})]}),t.pointsOfInterest.length>0&&(0,n.jsx)("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-md p-2",children:(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,n.jsx)("span",{children:"\uD83D\uDCCD"}),(0,n.jsxs)("span",{className:"font-medium",children:[t.pointsOfInterest.length," stops"]})]})})]})};function f(e){return e<1?"".concat(Math.round(1e3*e),"m"):"".concat(e.toFixed(1),"km")}function y(e){return"".concat(Math.round(e),"m")}function v(e){let t=Math.floor(e/60),a=Math.round(e%60);return 0===t?"".concat(a,"min"):0===a?"".concat(t,"h"):"".concat(t,"h ").concat(a,"min")}let b=e=>{let{route:t,className:a}=e,s=[{label:"Total Distance",value:f(t.distance),icon:"\uD83D\uDCCF",color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Elevation Gain",value:y(t.elevationGain),icon:"⛰️",color:"text-green-600",bgColor:"bg-green-50"},{label:"Estimated Time",value:v(t.estimatedTime),icon:"⏱️",color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Difficulty",value:{easy:"Easy",moderate:"Moderate",hard:"Challenging"}[t.difficulty],icon:"easy"===t.difficulty?"\uD83D\uDFE2":"moderate"===t.difficulty?"\uD83D\uDFE1":"\uD83D\uDD34",color:"easy"===t.difficulty?"text-green-600":"moderate"===t.difficulty?"text-yellow-600":"text-red-600",bgColor:"easy"===t.difficulty?"bg-green-50":"moderate"===t.difficulty?"bg-yellow-50":"bg-red-50"},{label:"Ride Type",value:"road"===t.rideType?"Road Cycling":"Gravel Cycling",icon:"road"===t.rideType?"\uD83D\uDEB4‍♂️":"\uD83D\uDEB5‍♂️",color:"text-gray-600",bgColor:"bg-gray-50"},{label:"Points of Interest",value:"".concat(t.pointsOfInterest.length," stops"),icon:"\uD83D\uDCCD",color:"text-orange-600",bgColor:"bg-orange-50"}],i=t.distance>0?t.elevationGain/(1e3*t.distance)*100:0,l=t.estimatedTime>0?t.distance/(t.estimatedTime/60):0;return(0,n.jsxs)("div",{className:(0,r.cn)("space-y-6",a),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"heading-4 mb-4",children:"Route Overview"}),(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((e,t)=>(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:(0,r.cn)("p-2 rounded-lg",e.bgColor),children:(0,n.jsx)("span",{className:"text-lg",children:e.icon})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:e.label}),(0,n.jsx)("p",{className:(0,r.cn)("text-lg font-semibold",e.color),children:e.value})]})]})})},t))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Surface Breakdown"}),(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsx)("div",{className:"space-y-3",children:Object.entries(t.surfaceTypes).map(e=>{let[t,a]=e;return a>0&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"paved"===t?"#22c55e":"gravel"===t?"#f97316":"trail"===t?"#8b5cf6":"#6b7280"}}),(0,n.jsx)("span",{className:"text-sm capitalize font-medium",children:t})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"h-2 rounded-full",style:{width:"".concat(a,"%"),backgroundColor:"paved"===t?"#22c55e":"gravel"===t?"#f97316":"trail"===t?"#8b5cf6":"#6b7280"}})}),(0,n.jsxs)("span",{className:"text-sm font-medium text-gray-600 min-w-[40px]",children:[a,"%"]})]})]},t)})})})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Additional Statistics"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:"Average Gradient"}),(0,n.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[i.toFixed(1),"%"]})]}),(0,n.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCC8"})]})})}),(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:"Average Speed"}),(0,n.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[l.toFixed(1)," km/h"]})]}),(0,n.jsx)("div",{className:"text-2xl",children:"⚡"})]})})}),(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:"Elevation Loss"}),(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:y(t.elevationLoss)})]}),(0,n.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCC9"})]})})}),(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:"Created"}),(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:t.createdAt.toLocaleDateString()})]}),(0,n.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCC5"})]})})})]})]}),t.pointsOfInterest.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Planned Stops (",t.pointsOfInterest.length,")"]}),(0,n.jsx)("div",{className:"space-y-2",children:t.pointsOfInterest.map((e,t)=>(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full text-sm font-medium",children:t+1}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,n.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:e.type.replace("_"," ")})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:f(e.distanceFromStart)}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:(0,r.cn)("w-2 h-2 rounded-full",e.isOpen?"bg-green-500":"bg-red-500")}),(0,n.jsx)("span",{className:"text-xs text-gray-500",children:e.estimatedArrivalTime.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]})})},e.id))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Route Quality"}),(0,n.jsx)("div",{className:"card border border-gray-200",children:(0,n.jsx)("div",{className:"card-content p-4",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm",children:"Cycling Suitability"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"h-2 bg-green-500 rounded-full",style:{width:"85%"}})}),(0,n.jsx)("span",{className:"text-sm font-medium text-green-600",children:"85%"})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm",children:"Scenic Value"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:"70%"}})}),(0,n.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"70%"})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm",children:"Safety Rating"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"h-2 bg-yellow-500 rounded-full",style:{width:"75%"}})}),(0,n.jsx)("span",{className:"text-sm font-medium text-yellow-600",children:"75%"})]})]})]})})})]})]})};class j{generateGPX(e,t){let a=t||e.metadata,n=this.generateGPXHeader(),s=this.generateMetadataSection(e,a),r=this.generateWaypoints(e.pointsOfInterest);return[n,s,r,this.generateTrack(e),this.generateGPXFooter()].join("\n")}validateGPX(e){try{if(!e.includes("<?xml")||!e.includes("<gpx")||!e.includes("</gpx>"))return!1;let t=e.includes("<trk>")&&e.includes("</trk>"),a=e.includes("<trkseg>")&&e.includes("</trkseg>");if(!t||!a)return!1;if("undefined"!=typeof DOMParser){let t=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("parsererror");return 0===t.length}return!0}catch(e){return console.error("GPX validation error:",e),!1}}addWaypoints(e,t){if(0===t.length)return e;let a=this.generateWaypoints(t),n=e.indexOf("</metadata>");if(-1!==n){let t=n+11;return e.slice(0,t)+"\n"+a+e.slice(t)}let s=e.indexOf(">");return -1!==s?e.slice(0,s+1)+"\n"+a+e.slice(s+1):e}generateGPXHeader(){return'<?xml version="1.0" encoding="UTF-8"?>\n<gpx version="1.1" creator="Pedal Peak Route Builder" \n     xmlns="http://www.topografix.com/GPX/1/1"\n     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">'}generateMetadataSection(e,t){let a=new Date().toISOString();return"  <metadata>\n    <name>".concat(this.escapeXML(e.name),"</name>\n    <desc>").concat(this.escapeXML(e.description||"Generated by Pedal Peak Route Builder"),'</desc>\n    <author>\n      <name>Pedal Peak Route Builder</name>\n      <link href="https://pedal-peak.com">\n        <text>Pedal Peak</text>\n      </link>\n    </author>\n    <copyright author="Pedal Peak">\n      <year>').concat(new Date().getFullYear(),"</year>\n      <license>https://pedal-peak.com/terms</license>\n    </copyright>\n    <time>").concat(a,"</time>\n    <keywords>cycling,").concat(e.rideType,",").concat(e.difficulty,'</keywords>\n    <bounds minlat="').concat(this.getMinLat(e.path),'" minlon="').concat(this.getMinLng(e.path),'" \n            maxlat="').concat(this.getMaxLat(e.path),'" maxlon="').concat(this.getMaxLng(e.path),'" />\n    <extensions>\n      <distance>').concat(e.distance,"</distance>\n      <elevation_gain>").concat(e.elevationGain,"</elevation_gain>\n      <elevation_loss>").concat(e.elevationLoss,"</elevation_loss>\n      <estimated_time>").concat(e.estimatedTime,"</estimated_time>\n      <difficulty>").concat(e.difficulty,"</difficulty>\n      <ride_type>").concat(e.rideType,"</ride_type>\n      <surface_paved>").concat(e.surfaceTypes.paved,"</surface_paved>\n      <surface_gravel>").concat(e.surfaceTypes.gravel,"</surface_gravel>\n      <surface_trail>").concat(e.surfaceTypes.trail,"</surface_trail>\n      <generated_by>").concat(t.generatedBy,"</generated_by>\n      <version>").concat(t.version,"</version>\n      <sources>").concat(t.sources.join(","),"</sources>\n    </extensions>\n  </metadata>")}generateWaypoints(e){return 0===e.length?"":e.map((e,t)=>{var a,n,s;let r=e.estimatedArrivalTime.toISOString();return'  <wpt lat="'.concat(e.location.lat,'" lon="').concat(e.location.lng,'">\n    <name>').concat(this.escapeXML(e.name),"</name>\n    <desc>").concat(this.escapeXML(this.getPOIDescription(e)),"</desc>\n    <type>").concat(e.type,"</type>\n    <sym>").concat(this.getPOISymbol(e.type),"</sym>\n    <extensions>\n      <distance_from_start>").concat(e.distanceFromStart,"</distance_from_start>\n      <estimated_arrival>").concat(r,"</estimated_arrival>\n      <is_open>").concat(e.isOpen,"</is_open>\n      <poi_type>").concat(e.type,"</poi_type>\n      ").concat((null==(a=e.contact)?void 0:a.phone)?"<phone>".concat(this.escapeXML(e.contact.phone),"</phone>"):"","\n      ").concat((null==(n=e.contact)?void 0:n.website)?"<website>".concat(this.escapeXML(e.contact.website),"</website>"):"","\n      ").concat((null==(s=e.contact)?void 0:s.address)?"<address>".concat(this.escapeXML(e.contact.address),"</address>"):"","\n    </extensions>\n  </wpt>")}).join("\n")}generateTrack(e){let t=e.path.map((t,a)=>{let n=this.getElevationForPoint(e,a);return'    <trkpt lat="'.concat(t.lat,'" lon="').concat(t.lng,'">').concat(null!==n?"\n    <ele>".concat(n,"</ele>"):"","\n    </trkpt>")}).join("\n");return"  <trk>\n    <name>".concat(this.escapeXML(e.name),"</name>\n    <desc>").concat(this.escapeXML(e.description||"Cycling route generated by Pedal Peak"),"</desc>\n    <type>").concat("road"===e.rideType?"Road Cycling":"Gravel Cycling","</type>\n    <extensions>\n      <distance>").concat(e.distance,"</distance>\n      <elevation_gain>").concat(e.elevationGain,"</elevation_gain>\n      <difficulty>").concat(e.difficulty,"</difficulty>\n    </extensions>\n    <trkseg>\n").concat(t,"\n    </trkseg>\n  </trk>")}generateGPXFooter(){return"</gpx>"}escapeXML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}getMinLat(e){return Math.min(...e.map(e=>e.lat))}getMaxLat(e){return Math.max(...e.map(e=>e.lat))}getMinLng(e){return Math.min(...e.map(e=>e.lng))}getMaxLng(e){return Math.max(...e.map(e=>e.lng))}getPOIDescription(e){var t,a;let n=e.type.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),s=e.isOpen?"Open":"Closed",r=e.estimatedArrivalTime.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i="".concat(n," - ").concat(s," at estimated arrival (").concat(r,")");return(null==(t=e.contact)?void 0:t.phone)&&(i+="\nPhone: ".concat(e.contact.phone)),(null==(a=e.contact)?void 0:a.address)&&(i+="\nAddress: ".concat(e.contact.address)),i}getPOISymbol(e){return({cafe:"Restaurant",restaurant:"Restaurant",bakery:"Restaurant",bike_shop:"Bike Trail",viewpoint:"Scenic Area"})[e]||"Waypoint"}getElevationForPoint(e,t){if(e.metadata&&"elevationProfile"in e.metadata){let a=e.metadata.elevationProfile;if(a&&a[t])return a[t].elevation}return e.elevationGain>0&&e.path.length>1?Math.round(500+Math.sin(t/(e.path.length-1)*Math.PI*2)*(e.elevationGain/4)):null}generateFilename(e){let t=e.name.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"-").toLowerCase(),a=new Date().toISOString().split("T")[0];return"".concat(t,"-").concat(a,".gpx")}createDownloadBlob(e){return new Blob([e],{type:"application/gpx+xml",endings:"native"})}downloadGPX(e,t){let a=this.generateGPX(e,t),n=this.createDownloadBlob(a),s=this.generateFilename(e),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}getGPXDataURL(e,t){let a=this.generateGPX(e,t),n=this.createDownloadBlob(a);return URL.createObjectURL(n)}}let w=e=>{let{route:t,onDownload:a,onShare:l,isDownloading:o=!1,className:c}=e,[d,u]=(0,s.useState)("gpx"),[m,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!1),x=new j,b=async()=>{try{"gpx"===d||console.warn("".concat(d.toUpperCase()," export not yet implemented")),x.downloadGPX(t),a()}catch(e){console.error("Download failed:",e)}},w=async()=>{if(navigator.share)try{let e=x.generateGPX(t),a=x.createDownloadBlob(e),n=new File([a],x.generateFilename(t),{type:"application/gpx+xml"});await navigator.share({title:t.name,text:"Check out this cycling route: ".concat(t.name),files:[n]})}catch(e){console.error("Share failed:",e),h(!0)}else h(!0)},N=async()=>{try{let e="".concat(window.location.origin,"/routes/").concat(t.id);await navigator.clipboard.writeText(e),g(!0),setTimeout(()=>g(!1),2e3)}catch(e){console.error("Copy failed:",e)}};return(0,n.jsxs)("div",{className:(0,r.cn)("space-y-6",c),children:[(0,n.jsxs)("div",{className:"card border border-gray-200",children:[(0,n.jsxs)("div",{className:"card-header",children:[(0,n.jsx)("h3",{className:"heading-4",children:"Export Your Route"}),(0,n.jsx)("p",{className:"body-small text-gray-600",children:"Download your route for use with GPS devices and cycling apps"})]}),(0,n.jsxs)("div",{className:"card-content",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:f(t.distance)}),(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Distance"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:y(t.elevationGain)}),(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Elevation"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:v(t.estimatedTime)}),(0,n.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Time"})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Choose Export Format"}),(0,n.jsx)("div",{className:"space-y-2",children:[{value:"gpx",label:"GPX",description:"GPS Exchange Format - Compatible with most GPS devices and apps",icon:"\uD83D\uDCCD",recommended:!0},{value:"tcx",label:"TCX",description:"Training Center XML - Garmin format with training data",icon:"⌚",recommended:!1},{value:"kml",label:"KML",description:"Keyhole Markup Language - Google Earth compatible",icon:"\uD83C\uDF0D",recommended:!1}].map(e=>(0,n.jsxs)("label",{className:(0,r.cn)("flex items-start gap-3 p-3 border rounded-lg cursor-pointer transition-all",d===e.value?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:[(0,n.jsx)("input",{type:"radio",name:"exportFormat",value:e.value,checked:d===e.value,onChange:e=>u(e.target.value),className:"mt-1"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,n.jsx)("span",{className:"text-lg",children:e.icon}),(0,n.jsx)("span",{className:"font-medium text-sm",children:e.label}),e.recommended&&(0,n.jsx)("span",{className:"badge badge-success text-xs",children:"Recommended"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-600",children:e.description})]})]},e.value))})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(i.$,{onClick:b,disabled:o,size:"lg",className:"flex-1",children:o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Preparing Download..."]}):(0,n.jsxs)(n.Fragment,{children:["\uD83D\uDCE5 Download ",d.toUpperCase()]})}),l&&(0,n.jsx)(i.$,{onClick:w,variant:"outline",size:"lg",children:"\uD83D\uDCE4 Share"})]}),(0,n.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"text-blue-600 text-lg",children:"\uD83D\uDCA1"}),(0,n.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,n.jsx)("p",{className:"font-medium mb-1",children:"File Information"}),(0,n.jsxs)("ul",{className:"space-y-1 text-xs",children:[(0,n.jsxs)("li",{children:["• Filename: ",x.generateFilename(t)]}),(0,n.jsxs)("li",{children:["• Includes waypoints for all ",t.pointsOfInterest.length," planned stops"]}),(0,n.jsx)("li",{children:"• Compatible with Garmin, Wahoo, and most cycling computers"}),(0,n.jsx)("li",{children:"• Can be imported into Strava, Komoot, and other cycling apps"})]})]})]})})]})]}),m&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,n.jsx)("h3",{className:"heading-4 mb-4",children:"Share Your Route"}),(0,n.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,n.jsxs)("button",{onClick:N,className:"w-full flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,n.jsx)("span",{className:"text-lg",children:"\uD83D\uDD17"}),(0,n.jsxs)("div",{className:"flex-1 text-left",children:[(0,n.jsx)("p",{className:"font-medium text-sm",children:"Copy Route Link"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Share a link to view this route online"})]}),p&&(0,n.jsx)("span",{className:"text-green-600 text-sm",children:"✓ Copied!"})]}),(0,n.jsxs)("button",{onClick:()=>{let e="Check out this ".concat(t.rideType," cycling route: ").concat(t.name," - ").concat(f(t.distance),", ").concat(y(t.elevationGain)," elevation gain"),a="".concat(window.location.origin,"/routes/").concat(t.id);window.open("https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(e),"&url=").concat(encodeURIComponent(a)),"_blank")},className:"w-full flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,n.jsx)("span",{className:"text-lg",children:"\uD83D\uDC26"}),(0,n.jsxs)("div",{className:"flex-1 text-left",children:[(0,n.jsx)("p",{className:"font-medium text-sm",children:"Share on Twitter"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Tweet about your route"})]})]}),(0,n.jsxs)("button",{onClick:()=>{let e="Check out this cycling route I created: ".concat(t.name),a="".concat(window.location.origin,"/routes/").concat(t.id);window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(a),"&quote=").concat(encodeURIComponent(e)),"_blank")},className:"w-full flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,n.jsx)("span",{className:"text-lg",children:"\uD83D\uDCD8"}),(0,n.jsxs)("div",{className:"flex-1 text-left",children:[(0,n.jsx)("p",{className:"font-medium text-sm",children:"Share on Facebook"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Post to your Facebook timeline"})]})]})]}),(0,n.jsx)("div",{className:"flex gap-3",children:(0,n.jsx)(i.$,{onClick:()=>h(!1),variant:"outline",className:"flex-1",children:"Cancel"})})]})}),(0,n.jsxs)("div",{className:"card border border-gray-200",children:[(0,n.jsx)("div",{className:"card-header",children:(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"How to Use Your Downloaded Route"})}),(0,n.jsx)("div",{className:"card-content",children:(0,n.jsxs)("div",{className:"space-y-4 text-sm text-gray-600",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-medium text-gray-900 mb-1",children:"GPS Devices (Garmin, Wahoo, etc.)"}),(0,n.jsx)("p",{children:'Transfer the GPX file to your device\'s "Courses" or "Routes" folder via USB or your device\'s companion app.'})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-medium text-gray-900 mb-1",children:"Cycling Apps (Strava, Komoot, etc.)"}),(0,n.jsx)("p",{children:"Import the GPX file through the app's route creation or import feature. Most apps support GPX import."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"font-medium text-gray-900 mb-1",children:"Smartphone Navigation"}),(0,n.jsx)("p",{children:"Open the GPX file with your preferred navigation app or import it into apps like Ride with GPS or Komoot."})]})]})})]})]})};var N=function(e){return e.INVALID_LOCATION="invalid_location",e.API_RATE_LIMIT="api_rate_limit",e.NO_ROUTE_FOUND="no_route_found",e.POI_UNAVAILABLE="poi_unavailable",e.NETWORK_ERROR="network_error",e.VALIDATION_ERROR="validation_error",e}({});class k{canMakeRequest(e){let t=Date.now(),a=(this.requests.get(e)||[]).filter(e=>t-e<this.config.windowMs);return this.requests.set(e,a),a.length<this.config.maxRequests}recordRequest(e){let t=this.requests.get(e)||[];t.push(Date.now()),this.requests.set(e,t)}getRetryAfter(e){let t=this.requests.get(e)||[];if(0===t.length)return 0;let a=Math.min(...t);return Math.max(0,this.config.windowMs-(Date.now()-a))}constructor(e){this.config=e,this.requests=new Map}}class D{async getStravaHeatmap(e,t){let a="strava-heatmap";if(!this.stravaLimiter.canMakeRequest(a))throw this.createRateLimitError("strava",this.stravaLimiter.getRetryAfter(a));try{return this.stravaLimiter.recordRequest(a),{segments:[{path:[{lat:e.south+(e.north-e.south)*.2,lng:e.west+(e.east-e.west)*.2},{lat:e.south+(e.north-e.south)*.8,lng:e.west+(e.east-e.west)*.8}],popularity:85,surface:"paved"}],bounds:e}}catch(e){throw this.createNetworkError("Failed to fetch Strava heatmap data",e)}}async getKomootRoute(e,t,a){let n="komoot-route";if(!this.komootLimiter.canMakeRequest(n))throw this.createRateLimitError("komoot",this.komootLimiter.getRetryAfter(n));try{return this.komootLimiter.recordRequest(n),await this.getOSMRoute(e,t,a)}catch(e){throw this.createNetworkError("Failed to fetch route data",e)}}async getRideWithGPSElevation(e){let t="ridewithgps-elevation";if(!this.ridewithgpsLimiter.canMakeRequest(t))throw this.createRateLimitError("ridewithgps",this.ridewithgpsLimiter.getRetryAfter(t));try{return this.ridewithgpsLimiter.recordRequest(t),{points:e.map((t,a)=>({location:t,elevation:500+200*Math.sin(a/e.length*Math.PI*2),distance:a*(this.calculatePathDistance(e)/e.length)})),totalGain:500*Math.random()+100,totalLoss:400*Math.random()+80,maxElevation:800,minElevation:300}}catch(e){throw this.createNetworkError("Failed to fetch elevation data",e)}}async getOpeningHours(e){let t="places-opening-hours";if(!this.placesLimiter.canMakeRequest(t))throw this.createRateLimitError("places",this.placesLimiter.getRetryAfter(t));try{return this.placesLimiter.recordRequest(t),{monday:{open:"08:00",close:"18:00"},tuesday:{open:"08:00",close:"18:00"},wednesday:{open:"08:00",close:"18:00"},thursday:{open:"08:00",close:"18:00"},friday:{open:"08:00",close:"18:00"},saturday:{open:"09:00",close:"17:00"},sunday:{open:"10:00",close:"16:00"}}}catch(e){throw this.createNetworkError("Failed to fetch opening hours",e)}}async getOSMRoute(e,t,a){try{let n=await fetch("/api/route-builder/osm-route",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({start:e,end:t,profile:a}),signal:AbortSignal.timeout(15e3)});if(!n.ok){let e=await n.json().catch(()=>({error:"Unknown error"}));throw Error("Routing API error: ".concat(n.status," - ").concat(e.error||"Failed to generate route"))}let s=await n.json();if(s.error)throw Error("Routing service error: ".concat(s.error));return this.parseOSMResponse(s)}catch(e){throw console.error("OSM Route API failed:",e),this.createNetworkError("Failed to fetch route data from routing services",e)}}parseKomootResponse(e){var t,a,n,s,r,i,l,o,c;let d=((null==(n=e.features)||null==(a=n[0])||null==(t=a.geometry)?void 0:t.coordinates)||[]).map(e=>({lng:e[0],lat:e[1]})),u=(null==(r=e.features)||null==(s=r[0])?void 0:s.properties)||{};return{path:d,distance:((null==(l=u.segments)||null==(i=l[0])?void 0:i.distance)||0)/1e3,elevationProfile:this.generateElevationProfile(d,u.ascent||0),surface:"mixed",difficulty:this.calculateDifficultyFromDistance((null==(c=u.segments)||null==(o=c[0])?void 0:o.distance)||0)}}parseElevationResponse(e,t){let a=(e.results||[]).map((e,a)=>({location:t[a]||{lat:0,lng:0},elevation:e.elevation||0,distance:a*(this.calculatePathDistance(t)/t.length)})),n=a.map(e=>e.elevation);return{points:a,totalGain:this.calculateElevationGain(n),totalLoss:this.calculateElevationLoss(n),maxElevation:Math.max(...n),minElevation:Math.min(...n)}}parseOpeningHoursResponse(e){var t,a;let n=(null==(a=e.result)||null==(t=a.opening_hours)?void 0:t.periods)||[],s={},r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];return n.forEach(e=>{if(e.open&&e.close){let t=r[e.open.day];t&&"isOpen24Hours"!==t&&"isClosed"!==t&&(s[t]={open:this.formatTime(e.open.time),close:this.formatTime(e.close.time)})}}),s}parseOSMResponse(e){var t,a,n,s;let r=((null==(n=e.routes)||null==(a=n[0])||null==(t=a.geometry)?void 0:t.coordinates)||[]).map(e=>({lng:e[0],lat:e[1]})),i=(null==(s=e.routes)?void 0:s[0])||{};return{path:r,distance:(i.distance||0)/1e3,elevationProfile:this.generateElevationProfile(r,i.ascent||0),surface:"mixed",difficulty:this.calculateDifficultyFromDistance(i.distance||0)}}generateElevationProfile(e,t){return e.map((a,n)=>({location:a,elevation:500+Math.sin(n/e.length*Math.PI*2)*(t/4),distance:n*(this.calculatePathDistance(e)/e.length)}))}calculatePathDistance(e){let t=0;for(let a=1;a<e.length;a++)t+=this.haversineDistance(e[a-1],e[a]);return t}haversineDistance(e,t){let a=this.toRadians(t.lat-e.lat),n=this.toRadians(t.lng-e.lng),s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.toRadians(e.lat))*Math.cos(this.toRadians(t.lat))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371}toRadians(e){return Math.PI/180*e}calculateElevationGain(e){let t=0;for(let a=1;a<e.length;a++){let n=e[a]-e[a-1];n>0&&(t+=n)}return t}calculateElevationLoss(e){let t=0;for(let a=1;a<e.length;a++){let n=e[a-1]-e[a];n>0&&(t+=n)}return t}calculateDifficultyFromDistance(e){let t=e/1e3;return t<20?1:t<50?2:t<100?3:4}formatTime(e){return 4===e.length?"".concat(e.slice(0,2),":").concat(e.slice(2)):e}createRateLimitError(e,t){return{type:N.API_RATE_LIMIT,message:"Rate limit exceeded for ".concat(e,". Please try again in ").concat(Math.ceil(t/1e3)," seconds."),details:{service:e,retryAfter:t},recoverable:!0,suggestedAction:"Wait ".concat(Math.ceil(t/1e3)," seconds before retrying")}}createNetworkError(e,t){return{type:N.NETWORK_ERROR,message:e,details:t,recoverable:!0,suggestedAction:"Check your internet connection and try again"}}generateMockRoutePath(e,t){let a=[];for(let n=0;n<=20;n++){let s=n/20,r=e.lat+(t.lat-e.lat)*s,i=e.lng+(t.lng-e.lng)*s,l=r+(Math.random()-.5)*.002,o=i+(Math.random()-.5)*.002;a.push({lat:l,lng:o})}return a}calculateDistance(e,t){let a=this.toRadians(t.lat-e.lat),n=this.toRadians(t.lng-e.lng),s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.toRadians(e.lat))*Math.cos(this.toRadians(t.lat))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371}constructor(){this.stravaLimiter=new k({maxRequests:100,windowMs:9e5}),this.komootLimiter=new k({maxRequests:1e3,windowMs:36e5}),this.ridewithgpsLimiter=new k({maxRequests:500,windowMs:36e5}),this.placesLimiter=new k({maxRequests:1e3,windowMs:864e5})}}function R(e,t){let a=O(t.lat-e.lat),n=O(t.lng-e.lng),s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(O(e.lat))*Math.cos(O(t.lat))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371}function P(e){if(e.length<2)return 0;let t=0;for(let a=1;a<e.length;a++)t+=R(e[a-1],e[a]);return t}function O(e){return Math.PI/180*e}class M{async findPOIsAlongRoute(e,t){let a=[];for(let n of t)try{let t=await this.findPOIsForType(e,n);a.push(...t)}catch(e){console.warn("Failed to find POIs for type ".concat(n.type,":"),e)}return a.sort((e,t)=>e.distanceFromStart-t.distanceFromStart)}async findPOIsNearRoute(e,t,a){let n=t.map(e=>({type:e,distanceKm:a}));return this.findPOIsAlongRoute(e,n)}async findPOIsForType(e,t){let a=[],n=this.calculateRouteDistance(e),s=t.distanceKm;if(s>0&&s<n){let n=this.getPointAtDistance(e,s);if(n)try{let e=await this.findNearestPOI(n,t.type,s,t.name);e&&a.push(e)}catch(e){console.warn("Failed to find POI at distance ".concat(s,"km:"),e)}}return a}async findNearestPOI(e,t,a,n){try{var s,r;let i=this.buildOverpassQuery(e,t),l=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!l.ok)throw Error("Overpass API error: ".concat(l.status));let o=(await l.json()).elements||[];if(0===o.length)return this.createMockPOI(e,t,a,n);let c=o.reduce((t,a)=>{let n=R(e,{lat:a.lat,lng:a.lon}),s=R(e,{lat:t.lat,lng:t.lon});return n<s?a:t}),d=await this.getOpeningHoursForPOI(c),u=this.calculateArrivalTime(a),m=this.checkIfOpen(d,u);return{id:(null==(s=c.id)?void 0:s.toString())||"mock_".concat(Date.now()),name:(null==(r=c.tags)?void 0:r.name)||this.getDefaultPOIName(t),type:t,location:{lat:c.lat,lng:c.lon},openingHours:d,distanceFromStart:a,estimatedArrivalTime:u,isOpen:m,contact:this.extractContactInfo(c.tags)}}catch(s){return console.warn("Failed to find POI via Overpass API, using mock data:",s),this.createMockPOI(e,t,a,n)}}buildOverpassQuery(e,t){let a="".concat(e.lat-.02,",").concat(e.lng-.02,",").concat(e.lat+.02,",").concat(e.lng+.02),n={cafe:"cafe",restaurant:"restaurant",bakery:"bakery",bike_shop:"bicycle",viewpoint:"viewpoint"}[t]||"cafe";return'[out:json][timeout:25];\n(\n  node["amenity"="'.concat(n,'"](').concat(a,');\n  way["amenity"="').concat(n,'"](').concat(a,');\n  relation["amenity"="').concat(n,'"](').concat(a,");\n);\nout center meta;")}async getOpeningHoursForPOI(e){var t,a;let n=null==(t=e.tags)?void 0:t.opening_hours;if(n)return this.parseOpeningHours(n);if(null==(a=e.tags)?void 0:a.name)try{return this.getDefaultOpeningHours()}catch(e){console.warn("Failed to get opening hours from Google Places:",e)}return this.getDefaultOpeningHours()}parseOpeningHours(e){if("24/7"===e)return{isOpen24Hours:!0};if(e.toLowerCase().includes("closed"))return{isClosed:!0};let t=e.match(/([A-Za-z]{2})-([A-Za-z]{2})\s+(\d{2}:\d{2})-(\d{2}:\d{2})/);if(t){let[,e,a,n,s]=t,r={Mo:"monday",Tu:"tuesday",We:"wednesday",Th:"thursday",Fr:"friday",Sa:"saturday",Su:"sunday"},i={},l=["Mo","Tu","We","Th","Fr","Sa","Su"],o=l.indexOf(e),c=l.indexOf(a);if(-1!==o&&-1!==c)for(let e=o;e<=c;e++){let t=r[l[e]];t&&"isOpen24Hours"!==t&&"isClosed"!==t&&(i[t]={open:n,close:s})}return i}return this.getDefaultOpeningHours()}getDefaultOpeningHours(){let e={open:"08:00",close:"18:00"};return{monday:e,tuesday:e,wednesday:e,thursday:e,friday:e,saturday:{open:"09:00",close:"17:00"},sunday:{open:"10:00",close:"16:00"}}}calculateArrivalTime(e){return new Date(Date.now()+e/20*36e5)}checkIfOpen(e,t){if(e.isOpen24Hours)return!0;if(e.isClosed)return!1;let a=e[["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()]];if(!a||"boolean"==typeof a)return!1;let n=t.toTimeString().slice(0,5);return n>=a.open&&n<=a.close}extractContactInfo(e){if(!e)return;let t={};return e.phone&&(t.phone=e.phone),e.website&&(t.website=e.website),(e["addr:full"]||e["addr:street"])&&(t.address=e["addr:full"]||"".concat(e["addr:street"]," ").concat(e["addr:housenumber"],", ").concat(e["addr:city"]).trim()),Object.keys(t).length>0?t:void 0}createMockPOI(e,t,a,n){let s={cafe:["Mountain View Cafe","Cyclist's Rest","Peak Coffee","Trail Side Cafe"],restaurant:["Alpine Bistro","Rider's Table","Mountain Kitchen","Scenic Eatery"],bakery:["Fresh Bread Bakery","Morning Glory Bakery","Artisan Breads","Village Bakery"],bike_shop:["Cycle Pro Shop","Mountain Bike Center","Pedal Power","Bike Repair Hub"],viewpoint:["Scenic Overlook","Mountain Vista","Valley View","Panorama Point"]}[t],r=n||s[Math.floor(Math.random()*s.length)],i=this.calculateArrivalTime(a),l=this.getDefaultOpeningHours(),o=(Math.random()-.5)*.01,c=(Math.random()-.5)*.01;return{id:"mock_".concat(t,"_").concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:r,type:t,location:{lat:e.lat+o,lng:e.lng+c},openingHours:l,distanceFromStart:a,estimatedArrivalTime:i,isOpen:this.checkIfOpen(l,i),contact:{phone:"+41 XX XXX XX XX",address:"Mock Address, Switzerland"}}}getDefaultPOIName(e){return({cafe:"Local Cafe",restaurant:"Local Restaurant",bakery:"Local Bakery",bike_shop:"Bike Shop",viewpoint:"Scenic Viewpoint"})[e]}calculateRouteDistance(e){let t=0;for(let a=1;a<e.length;a++)t+=R(e[a-1],e[a]);return t}getPointAtDistance(e,t){let a=0;for(let n=1;n<e.length;n++){let s=R(e[n-1],e[n]);if(a+s>=t){let r=(t-a)/s;return{lat:e[n-1].lat+(e[n].lat-e[n-1].lat)*r,lng:e[n-1].lng+(e[n].lng-e[n-1].lng)*r}}a+=s}return null}async checkOpeningHours(e,t){return this.checkIfOpen(e.openingHours,t)}async filterAvailablePOIs(e,t){let a=[];for(let n=0;n<e.length&&n<t.length;n++){let s=e[n],r=t[n];await this.checkOpeningHours(s,r)&&a.push({...s,estimatedArrivalTime:r,isOpen:!0})}return a}constructor(){this.externalAPI=new D}}function L(e,t,a){return Math.round(e/("road"===a?25:20)*60+t/100*("road"===a?3:4))}function C(e,t,a){let n=0;return(e>100?n+=3:e>50?n+=2:e>25&&(n+=1),t>2e3?n+=3:t>1e3?n+=2:t>500&&(n+=1),"gravel"===a&&(n+=1),n>=5)?"hard":n>=3?"moderate":"easy"}function I(e){return e.split(",")[0].trim()}class S{async generateRoute(e){let t=this.validateInputs(e);if(!t.isValid)throw Error("Invalid route parameters: ".concat(t.errors.map(e=>e.message).join(", ")));try{let t=await this.geocodeLocation(e.startLocation),a=await this.geocodeLocation(e.endLocation),n=await this.getBaseRoute(t,a,e.rideType),s=await this.optimizeRouteForPreferences(n,e),r=await this.addElevationData(s),i=await this.addPointsOfInterest(r,e.pointsOfInterest);return await this.finalizeRoute(i,e)}catch(e){throw console.error("Route generation failed:",e),Error("Failed to generate route: ".concat(e instanceof Error?e.message:"Unknown error"))}}async optimizeRoute(e,t){try{let a=[...e.path];t.avoidHighways&&(a=await this.avoidHighways(a,e.rideType)),t.preferScenicRoutes&&(a=await this.preferScenicRoutes(a,e.rideType));let n=P(a),s=await this.externalAPI.getRideWithGPSElevation(a),r=L(n,s.totalGain,e.rideType),i=C(n,s.totalGain,e.rideType);return{...e,path:a,distance:n,elevationGain:s.totalGain,elevationLoss:s.totalLoss,estimatedTime:r,difficulty:i,metadata:{...e.metadata,generatedAt:new Date}}}catch(t){return console.error("Route optimization failed:",t),e}}validateInputs(e){return l(e)}async geocodeLocation(e){try{let t=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=1"));if(!t.ok)throw Error("Geocoding failed: ".concat(t.status));let a=await t.json();if(!a||0===a.length)throw Error("Location not found: ".concat(e));return{lat:parseFloat(a[0].lat),lng:parseFloat(a[0].lon)}}catch(t){return console.error("Geocoding error:",t),this.getMockCoordinates(e)}}getMockCoordinates(e){let t={zurich:{lat:47.3769,lng:8.5417},bern:{lat:46.9481,lng:7.4474},geneva:{lat:46.2044,lng:6.1432},basel:{lat:47.5596,lng:7.5886},lausanne:{lat:46.5197,lng:6.6323}},a=e.toLowerCase();for(let[e,n]of Object.entries(t))if(a.includes(e))return n;return t.zurich}async getBaseRoute(e,t,a){try{let n=await this.externalAPI.getOSMRoute(e,t,a);return{path:n.path,distance:n.distance,surface:n.surface}}catch(e){throw console.error("All real routing services failed:",e),Error("Unable to generate route: All routing services are currently unavailable. Please check your internet connection and try again. "+"(Error: ".concat(e instanceof Error?e.message:"Unknown error",")"))}}generateSimpleRoute(e,t){let a=[];for(let n=0;n<=10;n++){let s=n/10;a.push({lat:e.lat+(t.lat-e.lat)*s,lng:e.lng+(t.lng-e.lng)*s})}return{path:a,distance:P(a),surface:"mixed"}}async optimizeRouteForPreferences(e,t){let a=[...e.path],n=(t.distance.min+t.distance.max)/2,s=e.distance;return s<t.distance.min?a=await this.addDetours(a,n-s,t.rideType):s>t.distance.max&&(a=await this.findShortcuts(a,s-n)),"flat"===t.elevation?a=await this.preferFlatRoute(a):"challenging"===t.elevation&&(a=await this.preferHillyRoute(a)),{path:a,distance:P(a),surface:e.surface}}async addDetours(e,t,a){let n=Math.floor(e.length/2),s=e[n],r=t/(2*Math.PI*111),i=[];for(let e=0;e<8;e++){let t=e/8*2*Math.PI;i.push({lat:s.lat+Math.cos(t)*r,lng:s.lng+Math.sin(t)*r})}return[...e.slice(0,n),...i,...e.slice(n)]}async findShortcuts(e,t){let a=Math.max(5,Math.floor(.8*e.length)),n=Math.floor(e.length/a),s=[];for(let t=0;t<e.length;t+=n)s.push(e[t]);return s[s.length-1]!==e[e.length-1]&&s.push(e[e.length-1]),s}async preferFlatRoute(e){return e}async preferHillyRoute(e){return e}async avoidHighways(e,t){return e}async preferScenicRoutes(e,t){return e}async addElevationData(e){try{let t=await this.externalAPI.getRideWithGPSElevation(e.path);return{...e,elevationGain:t.totalGain,elevationLoss:t.totalLoss,elevationProfile:t.points}}catch(a){console.warn("Failed to get elevation data, using estimates:",a);let t=10*e.distance;return{...e,elevationGain:t,elevationLoss:.9*t,elevationProfile:[]}}}async addPointsOfInterest(e,t){try{let a=await this.poiService.findPOIsAlongRoute(e.path,t);return{...e,pointsOfInterest:a}}catch(t){return console.warn("Failed to add POIs:",t),{...e,pointsOfInterest:[]}}}async finalizeRoute(e,t){let a=L(e.distance,e.elevationGain,t.rideType),n=C(e.distance,e.elevationGain,t.rideType),s=this.calculateSurfaceBreakdown(e.surface,t.rideType);return{id:"route_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:function(e){let{startLocation:t,endLocation:a,rideType:n,distance:s}=e,r=I(t),i=I(a),l=Math.round((s.min+s.max)/2),o="road"===n?"Road":"Gravel";return r===i?"".concat(r," ").concat(o," Loop (").concat(l,"km)"):"".concat(r," to ").concat(i," ").concat(o," Route (").concat(l,"km)")}(t),description:function(e){let{rideType:t,elevation:a,pointsOfInterest:n}=e,s="A ".concat(t," cycling route with ").concat(a," elevation profile.");if(n.length>0){let e=n.map(e=>e.type).join(", ");s+=" Includes stops at: ".concat(e,".")}return s+" Generated by Pedal Peak Route Builder."}(t),path:e.path,distance:e.distance,elevationGain:e.elevationGain,elevationLoss:e.elevationLoss,estimatedTime:a,surfaceTypes:s,pointsOfInterest:e.pointsOfInterest,difficulty:n,rideType:t.rideType,createdAt:new Date,metadata:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{generatedBy:"pedal-peak-route-builder",version:"1.0.0",sources:t,generatedAt:new Date,preferences:e}}(t,["komoot","osm","elevation-api"])}}calculateSurfaceBreakdown(e,t){return"road"===t?{paved:85,gravel:10,trail:0,unknown:5}:{paved:30,gravel:50,trail:15,unknown:5}}constructor(){this.externalAPI=new D,this.poiService=new M}}let _=e=>{let{className:t}=e,[a,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)("preview"),p=new S,g=(0,s.useCallback)(async e=>{i(!0),u(null);try{let t=await p.generateRoute(e);c(t),h("preview")}catch(e){u(e instanceof Error?e.message:"Failed to generate route"),console.error("Route generation error:",e)}finally{i(!1)}},[]),f=(0,s.useCallback)(()=>{console.log("Route downloaded:",null==l?void 0:l.id)},[l]),y=(0,s.useCallback)(()=>{console.log("Route shared:",null==l?void 0:l.id)},[l]);return(0,n.jsxs)("div",{className:(0,r.cn)("max-w-7xl mx-auto p-4 space-y-6",t),children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("h1",{className:"heading-1 mb-4",children:"Route Builder"}),(0,n.jsx)("p",{className:"body-large text-gray-600 max-w-2xl mx-auto",children:"Create intelligent cycling routes with automatic POI discovery, elevation analysis, and GPX export. Powered by Strava, Komoot, and RideWithGPS data."})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,n.jsxs)("div",{className:"lg:col-span-1",children:[(0,n.jsx)(o,{onRouteGenerate:g,isLoading:a}),d&&(0,n.jsx)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"text-red-600 text-lg",children:"⚠️"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-red-900 mb-1",children:"Route Generation Failed"}),(0,n.jsx)("p",{className:"text-sm text-red-700",children:d}),(0,n.jsx)("button",{onClick:()=>u(null),className:"text-xs text-red-600 hover:text-red-800 mt-2 underline",children:"Dismiss"})]})]})})]}),(0,n.jsxs)("div",{className:"lg:col-span-2",children:[l&&(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[{id:"preview",label:"Map Preview",icon:"\uD83D\uDDFA️"},{id:"metrics",label:"Route Details",icon:"\uD83D\uDCCA"},{id:"export",label:"Download",icon:"\uD83D\uDCE5"}].map(e=>(0,n.jsxs)("button",{onClick:()=>h(e.id),className:(0,r.cn)("flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-all",m===e.id?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,n.jsx)("span",{children:e.icon}),(0,n.jsx)("span",{className:"hidden sm:inline",children:e.label})]},e.id))})}),(0,n.jsxs)("div",{className:"min-h-[500px]",children:["preview"===m&&(0,n.jsx)(x,{route:l,isLoading:a,className:"h-full"}),"metrics"===m&&l&&(0,n.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:(0,n.jsx)(b,{route:l})}),"export"===m&&l&&(0,n.jsx)(w,{route:l,onDownload:f,onShare:y}),!l&&!a&&(0,n.jsx)("div",{className:"flex items-center justify-center h-96 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83D\uDEB4‍♂️"}),(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ready to Build Your Route?"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4 max-w-sm",children:"Fill out the form on the left with your preferences and we'll generate an optimized cycling route for you."}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-4 text-sm text-gray-500",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDDFA️"}),(0,n.jsx)("span",{children:"Interactive Map"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDCCD"}),(0,n.jsx)("span",{children:"POI Discovery"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{children:"\uD83D\uDCE5"}),(0,n.jsx)("span",{children:"GPX Export"})]})]})]})})]})]})]}),(0,n.jsxs)("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[(0,n.jsx)("h2",{className:"heading-3 text-center mb-8",children:"Powered by the Best Cycling Data"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,n.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD25"})}),(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"Strava Heatmaps"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Routes follow popular cycling segments used by millions of cyclists worldwide"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,n.jsx)("span",{className:"text-2xl",children:"\uD83D\uDDFA️"})}),(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"Komoot Integration"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Surface-specific routing for road and gravel cycling with detailed terrain analysis"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,n.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC8"})}),(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"RideWithGPS Data"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Accurate elevation profiles and route quality metrics from experienced cyclists"})]})]})]}),(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"font-semibold text-blue-900 mb-3",children:"\uD83D\uDCA1 Pro Tips"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-1",children:"For Best Results:"}),(0,n.jsxs)("ul",{className:"space-y-1",children:[(0,n.jsx)("li",{children:"• Use specific addresses or landmarks as start/end points"}),(0,n.jsx)("li",{children:"• Set realistic distance ranges based on your fitness level"}),(0,n.jsx)("li",{children:"• Consider weather and daylight when planning POI stops"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-1",children:"Route Optimization:"}),(0,n.jsxs)("ul",{className:"space-y-1",children:[(0,n.jsx)("li",{children:"• Road routes prioritize paved surfaces and bike paths"}),(0,n.jsx)("li",{children:"• Gravel routes include scenic off-road sections"}),(0,n.jsx)("li",{children:"• POI opening hours are checked automatically"})]})]})]})]})]})}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var n=a(2596),s=a(9688);let r=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,n.$)(t))}},9708:(e,t,a)=>{"use strict";a.d(t,{DX:()=>l,TL:()=>i});var n=a(2115),s=a(6101),r=a(5155);function i(e){let t=function(e){let t=n.forwardRef((e,t)=>{let{children:a,...r}=e;if(n.isValidElement(a)){var i;let e,l,o=(i=a,(l=(e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?i.ref:(l=(e=Object.getOwnPropertyDescriptor(i,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?i.props.ref:i.props.ref||i.ref),c=function(e,t){let a={...t};for(let n in t){let s=e[n],r=t[n];/^on[A-Z]/.test(n)?s&&r?a[n]=(...e)=>{let t=r(...e);return s(...e),t}:s&&(a[n]=s):"style"===n?a[n]={...s,...r}:"className"===n&&(a[n]=[s,r].filter(Boolean).join(" "))}return{...e,...a}}(r,a.props);return a.type!==n.Fragment&&(c.ref=t?(0,s.t)(t,o):o),n.cloneElement(a,c)}return n.Children.count(a)>1?n.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),a=n.forwardRef((e,a)=>{let{children:s,...i}=e,l=n.Children.toArray(s),o=l.find(c);if(o){let e=o.props.children,s=l.map(t=>t!==o?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,r.jsx)(t,{...i,ref:a,children:n.isValidElement(e)?n.cloneElement(e,void 0,s):null})}return(0,r.jsx)(t,{...i,ref:a,children:s})});return a.displayName=`${e}.Slot`,a}var l=i("Slot"),o=Symbol("radix.slottable");function c(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}}},e=>{var t=t=>e(e.s=t);e.O(0,[277,441,684,358],()=>t(1198)),_N_E=e.O()}]);